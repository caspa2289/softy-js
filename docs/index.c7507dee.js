!function(){class e{constructor(e,t,n){this.x=e,this.y=t,this.z=n}}let t=(t,n)=>{let r=t.x*n[0][0]+t.y*n[1][0]+t.z*n[2][0]+n[3][0],s=t.x*n[0][1]+t.y*n[1][1]+t.z*n[2][1]+n[3][1],x=t.x*n[0][2]+t.y*n[1][2]+t.z*n[2][2]+n[3][2],v=t.x*n[0][3]+t.y*n[1][3]+t.z*n[2][3]+n[3][3];return 0!==v?new e(r/v,s/v,x/v):new e(r,s,x)},n=e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),r=t=>{let r=n(t);return new e(t.x/r,t.y/r,t.z/r)},s=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z;class x{static rasterize(e,t,n,r,s,x){s.fillStyle="black",s.fillRect(0,0,n,r),e.forEach(e=>{e.getVisibleTrisSortedByZ(t,n,r,x).forEach(e=>{this._drawTriangle(e,s),//FIXME: вернуть как wireframe мод для дебага
s.fillStyle="green";for(let t=0;t<e.vertexes.length;t++){let n=t===e.vertexes.length-1?0:t+1;this._drawLine(e.vertexes[t],e.vertexes[n],s)}})})}static _drawLine(e,t,n){let{x:r,y:s}=e,{x:x,y:v}=t,f=x-r,a=v-s,l=Math.abs(f)>Math.abs(a)?Math.abs(f):Math.abs(a),[i,h]=[r,s];f/=l,a/=l;for(let e=0;e<=l;e++)n.fillRect(Math.round(i),Math.round(h),1,1),i+=f,h+=a}static _drawTriangle(t,n){//determine the triangle bounding box
let x=Math.max(t.vertexes[0].x,Math.max(t.vertexes[1].x,t.vertexes[2].x)),v=Math.min(t.vertexes[0].x,Math.min(t.vertexes[1].x,t.vertexes[2].x)),f=Math.max(t.vertexes[0].y,Math.max(t.vertexes[1].y,t.vertexes[2].y)),a=Math.min(t.vertexes[0].y,Math.min(t.vertexes[1].y,t.vertexes[2].y)),l=new e(0,0,-1),i=r(l),{normal:h}=t;if(h){let e=s(i,h),t=255*e;n.fillStyle=`rgb(${t},${t},${t})`}let o={x:t.vertexes[1].x-t.vertexes[0].x,y:t.vertexes[1].y-t.vertexes[0].y},y={x:t.vertexes[2].x-t.vertexes[0].x,y:t.vertexes[2].y-t.vertexes[0].y},c=(e,t)=>e.x*t.y-e.y*t.x;for(let e=v;e<=x;e++)for(let r=a;r<=f;r++){let s={x:e-t.vertexes[0].x,y:r-t.vertexes[0].y},x=c(s,y)/c(o,y),v=c(o,s)/c(o,y);x>=0&&v>=0&&x+v<=1&&n.fillRect(Math.ceil(e),Math.ceil(r),1,1)}}}var v,f={};f="# Blender 4.0.2\n# www.blender.org\no Cube\nv 1.112255 1.000000 -0.648811\nv 0.586353 -1.000000 -0.586353\nv 0.868856 1.000000 0.648811\nv 0.586353 -1.000000 0.586353\nv -1.112255 1.000000 -0.648811\nv -0.586353 -1.000000 -0.586353\nv -0.868856 1.000000 0.648811\nv -0.586353 -1.000000 0.586353\nv 1.992857 1.392449 -1.392449\nv 1.992857 -1.392449 -1.392449\nv 1.992857 1.392449 1.392449\nv 1.992857 -1.392449 1.392449\nv 3.192454 1.392449 -1.392449\nv 3.192454 -1.392449 -1.392449\nv 3.192454 1.392449 1.392449\nv 3.192454 -1.392449 1.392449\nv 4.084236 0.551429 -0.551429\nv 4.084236 -0.551429 -0.551429\nv 4.084236 0.551429 0.551429\nv 4.084236 -0.551429 0.551429\nv -2.129586 -1.523273 -1.523273\nv -2.129586 -1.523273 1.523273\nv -2.129586 1.523273 1.523273\nv -2.129586 1.523273 -1.523273\nv -3.385051 -1.523273 -1.523273\nv -3.385051 -1.523273 1.523273\nv -3.385051 1.523273 1.523273\nv -3.385051 1.523273 -1.523273\nv -4.542562 -0.527586 -0.527586\nv -4.542562 -0.527586 0.527586\nv -4.542562 0.527586 0.527586\nv -4.542562 0.527586 -0.527586\nv 0.648811 6.280553 0.648811\nv -0.648811 6.280553 0.648811\nv 0.648811 6.280553 -0.648811\nv -0.648811 6.280553 -0.648811\nv 0.983584 7.435852 0.983584\nv -0.983584 7.435852 0.983584\nv 0.983584 7.435852 -0.983584\nv -0.983584 7.435852 -0.983584\nv 0.549968 8.407492 0.549968\nv -0.549968 8.407492 0.549968\nv 0.549968 8.407492 -0.549968\nv -0.549968 8.407492 -0.549968\ns 0\nf 7 36 5\nf 3 8 4\nf 5 23 7\nf 2 8 6\nf 1 11 9\nf 5 2 6\nf 11 13 9\nf 3 12 11\nf 1 10 2\nf 2 12 4\nf 13 18 14\nf 9 14 10\nf 10 16 12\nf 12 15 11\nf 17 20 18\nf 14 20 16\nf 16 19 15\nf 15 17 13\nf 21 28 24\nf 5 21 24\nf 7 22 8\nf 8 21 6\nf 28 31 27\nf 22 25 21\nf 24 27 23\nf 23 26 22\nf 31 29 30\nf 27 30 26\nf 25 32 28\nf 26 29 25\nf 36 39 35\nf 3 35 33\nf 5 35 1\nf 3 34 7\nf 38 44 40\nf 35 37 33\nf 34 40 36\nf 33 38 34\nf 44 41 43\nf 37 42 38\nf 40 43 39\nf 39 41 37\nf 7 34 36\nf 3 7 8\nf 5 24 23\nf 2 4 8\nf 1 3 11\nf 5 1 2\nf 11 15 13\nf 3 4 12\nf 1 9 10\nf 2 10 12\nf 13 17 18\nf 9 13 14\nf 10 14 16\nf 12 16 15\nf 17 19 20\nf 14 18 20\nf 16 20 19\nf 15 19 17\nf 21 25 28\nf 5 6 21\nf 7 23 22\nf 8 22 21\nf 28 32 31\nf 22 26 25\nf 24 28 27\nf 23 27 26\nf 31 32 29\nf 27 31 30\nf 25 29 32\nf 26 30 29\nf 36 40 39\nf 3 1 35\nf 5 36 35\nf 3 33 34\nf 38 42 44\nf 35 39 37\nf 34 38 40\nf 33 37 38\nf 44 42 41\nf 37 41 42\nf 40 44 43\nf 39 43 41\n";class a{constructor({vertexes:e,normal:t}){this._vertexes=e,this.normal=t}getScreenSpaceProjection(e,t,n,r){//FIXME: зарефачить
let s=this.getWorldSpaceProjection(e,r);return s?(s.vertexes[0].x=(s.vertexes[0].x+1)*.5*t,s.vertexes[0].y=(s.vertexes[0].y+1)*.5*n,s.vertexes[1].x=(s.vertexes[1].x+1)*.5*t,s.vertexes[1].y=(s.vertexes[1].y+1)*.5*n,s.vertexes[2].x=(s.vertexes[2].x+1)*.5*t,s.vertexes[2].y=(s.vertexes[2].y+1)*.5*n,s):null}getWorldSpaceProjection(n,r){let s=new a({vertexes:this.getVertexCopies()}),x=[[Math.cos(r),Math.sin(r),0,0],[-Math.sin(r),Math.cos(r),0,0],[0,0,1,0],[0,0,0,1]],v=[[1,0,0,0],[0,Math.cos(.5*r),Math.sin(.5*r),0],[0,-Math.sin(.5*r),Math.cos(.5*r),0],[0,0,0,1]];s.vertexes[0]=t(s.vertexes[0],v),s.vertexes[1]=t(s.vertexes[1],v),s.vertexes[2]=t(s.vertexes[2],v),s.vertexes[0]=t(s.vertexes[0],x),s.vertexes[1]=t(s.vertexes[1],x),s.vertexes[2]=t(s.vertexes[2],x),/**FILLER**///FIXME: убрать когда будет камера
s.vertexes[0].z+=12,s.vertexes[1].z+=12,s.vertexes[2].z+=12;let f=new e(s.vertexes[1].x-s.vertexes[0].x,s.vertexes[1].y-s.vertexes[0].y,s.vertexes[1].z-s.vertexes[0].z),l=new e(s.vertexes[2].x-s.vertexes[0].x,s.vertexes[2].y-s.vertexes[0].y,s.vertexes[2].z-s.vertexes[0].z),i=f.y*l.z-f.z*l.y,h=f.z*l.x-f.x*l.z,o=f.x*l.y-f.y*l.x,y=Math.sqrt(i*i+h*h+o*o),c=new e(i/y,h/y,o/y),z=new e(0,0,0),g=c.x*(s.vertexes[0].x-z.x)+c.y*(s.vertexes[0].y-z.y)+c.z*(s.vertexes[0].z-z.z);return g>0||isNaN(g)?null:new a({//FIXME: refactor
vertexes:[t(s.vertexes[0],n),t(s.vertexes[1],n),t(s.vertexes[2],n)],normal:c})}getVertexCopies(){return this._vertexes.map(t=>new e(t.x,t.y,t.z))}get vertexes(){return this._vertexes}set vertexes(e){this._vertexes=e}}class l{constructor(e){this._triangles=e}getVisibleTrisSortedByZ(e,t,n,r){//FIXME: заменить на toSorted() когда он в тс заедет
let s=[...this.getVisibleTris(e,t,n,r)];return s.sort((e,t)=>{let n=(e.vertexes[0].z+e.vertexes[1].z+e.vertexes[2].z)/3,r=(t.vertexes[0].z+t.vertexes[1].z+t.vertexes[2].z)/3;return Number(n>r)}),s}getVisibleTris(e,t,n,r){return this._triangles.reduce((s,x)=>{let v=x.getScreenSpaceProjection(e,t,n,r);return v?[...s,v]:s},[])}get triangles(){return this._triangles}set triangles(e){this._triangles=e}}let i=document.getElementById("canvas"),h=i.getContext("2d"),o=[[.75*(v=1/Math.tan(.25*Math.PI)),0,0,0],[0,v,0,0],[0,0,1.000100010001,1],[0,0,-.10001000100010002,0]],y=(class{//FIXME: сделать загрузку по урлу
static loadFromUrl(){var t;let n=((t=f)&&t.__esModule?t.default:t).split("\n"),r=[],s=[],x=0;return n.forEach(t=>{if("o"===t[0]&&(s[++x]={triangles:[]}),"v"===t[0]){let n=t.split(" ");r.push(new e(n[1],n[2],n[3]))}}),n.forEach(e=>{if("f"===e[0]){let t=e.split(" ");s[x].triangles.push(new a({vertexes:[r[t[1]-1],r[t[2]-1],r[t[3]-1]]}))}}),s.map(e=>new l(e.triangles))}}).loadFromUrl(),c=e=>{x.rasterize(y,o,640,480,h,e/1e3),requestAnimationFrame(c)};requestAnimationFrame(c)}();//# sourceMappingURL=index.c7507dee.js.map

//# sourceMappingURL=index.c7507dee.js.map
