function t(t){return t&&t.__esModule?t.default:t}var e,r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},o={},n=i.parcelRequireac70;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in o){var e=o[t];delete o[t];var r={id:t,exports:{}};return s[t]=r,e.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){o[t]=e},i.parcelRequireac70=n),(0,n.register)("kJlzD",function(t,e){Object.defineProperty(t.exports,"register",{get:function(){return r},set:function(t){return r=t},enumerable:!0,configurable:!0});var r,i=new Map;r=function(t,e){for(var r=0;r<e.length-1;r+=2)i.set(e[r],{baseUrl:t,path:e[r+1]})}}),n("kJlzD").register(new URL("",import.meta.url).toString(),JSON.parse('["81ar2","index.6becb380.js","73iMo","cubetexture.0f1795bd.jpg"]'));class a{constructor(t,e,r,i=1){this.x=t,this.y=e,this.z=r,this.w=i}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z,this.w)}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z,this.w)}}class h{constructor(t,e,r=1){this.u=t,this.v=e,this.w=r}}const v=[new h(0,0),new h(0,0),new h(0,0)];class w{constructor({vertexes:t,UVCoordinates:e=v,normal:r}){this._vertexes=t,this._UVCoordinates=e,this.normal=r}applyMatrixMut(t){return this.vertexes[0]=g(this.vertexes[0],t),this.vertexes[1]=g(this.vertexes[1],t),this.vertexes[2]=g(this.vertexes[2],t),this}normalizeInScreenSpaceMut(t,e){return(//account for perspective
this.UVCoordinates[0].u=this.UVCoordinates[0].u/this.vertexes[0].w,this.UVCoordinates[0].v=this.UVCoordinates[0].v/this.vertexes[0].w,this.UVCoordinates[0].w=1/this.vertexes[0].w,this.UVCoordinates[1].u=this.UVCoordinates[1].u/this.vertexes[1].w,this.UVCoordinates[1].v=this.UVCoordinates[1].v/this.vertexes[1].w,this.UVCoordinates[1].w=1/this.vertexes[1].w,this.UVCoordinates[2].u=this.UVCoordinates[2].u/this.vertexes[2].w,this.UVCoordinates[2].v=this.UVCoordinates[2].v/this.vertexes[2].w,this.UVCoordinates[2].w=1/this.vertexes[2].w,this.vertexes[0]=U(this.vertexes[0],this.vertexes[0].w),this.vertexes[1]=U(this.vertexes[1],this.vertexes[1].w),this.vertexes[2]=U(this.vertexes[2],this.vertexes[2].w),this.vertexes[0]=z(this.vertexes[0],-1),this.vertexes[1]=z(this.vertexes[1],-1),this.vertexes[2]=z(this.vertexes[2],-1),this.vertexes[0].x=(this.vertexes[0].x+1)*.5*t,this.vertexes[0].y=(this.vertexes[0].y+1)*.5*e,this.vertexes[1].x=(this.vertexes[1].x+1)*.5*t,this.vertexes[1].y=(this.vertexes[1].y+1)*.5*e,this.vertexes[2].x=(this.vertexes[2].x+1)*.5*t,this.vertexes[2].y=(this.vertexes[2].y+1)*.5*e,this)}getVertexCopies(){return this._vertexes.map(t=>new a(t.x,t.y,t.z,t.w))}getUVCoordinatesCopies(){return this._UVCoordinates.map(t=>new h(t.u,t.v,t.w))}getNormalCopy(){return this.normal?new a(this.normal.x,this.normal.y,this.normal.z,this.normal.w):void 0}getCopy(){return new w({vertexes:this.getVertexCopies(),UVCoordinates:this.getUVCoordinatesCopies(),normal:this.getNormalCopy()})}get vertexes(){return this._vertexes}get UVCoordinates(){return this._UVCoordinates}set vertexes(t){this._vertexes=t}set UVCoordinates(t){this._UVCoordinates=t}}const d=t=>Math.sqrt(u(t,t)),x=t=>{let e=d(t);return new a(t.x/e,t.y/e,t.z/e,t.w)},u=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,l=(t,e)=>new a(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x),c=t=>[[1,0,0,0],[0,Math.cos(t),Math.sin(t),0],[0,-Math.sin(t),Math.cos(t),0],[0,0,0,1]],p=t=>[[Math.cos(t),Math.sin(t),0,0],[-Math.sin(t),Math.cos(t),0,0],[0,0,1,0],[0,0,0,1]],_=t=>[[Math.cos(t),0,Math.sin(t),0],[0,1,0,0],[-Math.sin(t),0,Math.cos(t),0],[0,0,0,1]],y=(t,e,r)=>[[1,0,0,0],[0,1,0,0],[0,0,1,0],[t,e,r,1]],f=(t,e)=>{let r=p(t.z),i=c(t.x),s=_(t.y),o=y(e.x,e.y,e.z);//FIXME: зарефачить
return M(M(M(r,i),s),o)},g=(t,e)=>{let r=t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+t.w*e[3][0],i=t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+t.w*e[3][1],s=t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+t.w*e[3][2],o=t.x*e[0][3]+t.y*e[1][3]+t.z*e[2][3]+t.w*e[3][3];return new a(r,i,s,o)},M=(t,e)=>{let r=[[],[],[],[]];for(let i=0;i<4;i++)for(let s=0;s<4;s++)r[s][i]=t[s][0]*e[0][i]+t[s][1]*e[1][i]+t[s][2]*e[2][i]+t[s][3]*e[3][i];return r},m=(t,e,r,i)=>[[e.x,e.y,e.z,0],[r.x,r.y,r.z,0],[i.x,i.y,i.z,0],[t.x,t.y,t.z,1]],C=t=>[[t[0][0],t[1][0],t[2][0],0],[t[0][1],t[1][1],t[2][1],0],[t[0][2],t[1][2],t[2][2],0],[-(t[3][0]*t[0][0]+t[3][1]*t[0][1]+t[3][2]*t[0][2]),-(t[3][0]*t[1][0]+t[3][1]*t[1][1]+t[3][2]*t[1][2]),-(t[3][0]*t[2][0]+t[3][1]*t[2][1]+t[3][2]*t[2][2]),1]],z=(t,e)=>new a(t.x*e,t.y*e,t.z*e,t.w),U=(t,e)=>new a(t.x/e,t.y/e,t.z/e,t.w),b=(t,e,r,i)=>{let s=x(e),o=-u(s,t),n=u(r,s),a=u(i,s),h=(-o-n)/(a-n),v=i.subtract(r),w=z(v,h);return{vector:r.add(w),t:h}},V=(t,e,r)=>e.x*t.x+e.y*t.y+e.z*t.z-u(e,r),A=(t,e,r)=>{let i=x(e),s=[],o=[],n=[],v=[],d=r.getUVCoordinatesCopies();switch(r.getVertexCopies().forEach((e,r)=>{V(e,i,t)>=0?(s.push(e),n.push(d[r])):(o.push(e),v.push(d[r]))}),s.length){//Two sides of a triangle are clipped, create new triangle
case 1:{let i=b(t,e,s[0],o[0]),a=b(t,e,s[0],o[1]),d=new w({vertexes:[s[0],i.vector,a.vector],normal:r.normal,UVCoordinates:[n[0],new h(i.t*(v[0].u-n[0].u)+n[0].u,i.t*(v[0].v-n[0].v)+n[0].v,i.t*(v[0].w-n[0].w)+n[0].w),new h(a.t*(v[1].u-n[0].u)+n[0].u,a.t*(v[1].v-n[0].v)+n[0].v,a.t*(v[1].w-n[0].w)+n[0].w)]});return[d]}//One side of a triangle is clipped, divide resulting quad into two triangles
case 2:{let i=b(t,e,s[0],o[0]),d=b(t,e,s[1],o[0]),x=new w({vertexes:[new a(s[0].x,s[0].y,s[0].z,s[0].w),new a(s[1].x,s[1].y,s[1].z,s[1].w),i.vector],normal:r.normal,UVCoordinates:[new h(n[0].u,n[0].v,n[0].w),new h(n[1].u,n[1].v,n[1].w),new h(i.t*(v[0].u-n[0].u)+n[0].u,i.t*(v[0].v-n[0].v)+n[0].v,i.t*(v[0].w-n[0].w)+n[0].w)]}),u=new w({vertexes:[//FIXME: добавить векторам метод copy
new a(x.vertexes[1].x,x.vertexes[1].y,x.vertexes[1].z,x.vertexes[1].w),new a(x.vertexes[2].x,x.vertexes[2].y,x.vertexes[2].z,x.vertexes[2].w),d.vector],normal:r.normal,UVCoordinates:[new h(x.UVCoordinates[1].u,x.UVCoordinates[1].v,x.UVCoordinates[1].w),new h(x.UVCoordinates[2].u,x.UVCoordinates[2].v,x.UVCoordinates[2].w),new h(d.t*(v[0].u-n[1].u)+n[1].u,d.t*(v[0].v-n[1].v)+n[1].v,d.t*(v[0].w-n[1].w)+n[1].w)]});return[x,u]}// Triangle doesnt need clipping
case 3:return[r];// Triangle is completely clipped
default:return[]}},R=(t,e,r)=>{let{width:i,height:s}=t,o=Math.round(r*i),n=Math.round(e*s);return[t.data[n*(4*t.width)+4*o],t.data[n*(4*t.width)+4*o+1],t.data[n*(4*t.width)+4*o+2],t.data[n*(4*t.width)+4*o+3]]};(e=r||(r={})).GameObject="GameObject",e.Mesh="Mesh",e.Camera="Camera",e.Entity="Entity";class E{static rasterize(t,e,i,s,o){//FIXME: плейсхолдер
let n=window.camera,h=[{point:new a(0,0,0),normal:new a(0,1,0)},{point:new a(0,n.viewportHeight-1,0),normal:new a(0,-1,0)},{point:new a(0,0,0),normal:new a(1,0,0)},{point:new a(n.viewportWidth-1,0,0),normal:new a(-1,0,0)}];//FIXME: это скорее всего очень медленно
window.depthBuffer=Array(o.canvas.width*o.canvas.height).fill(0);let v=o.createImageData(o.canvas.width,o.canvas.height);t.forEach(t=>{let w=f(t.rotation,t.position);t.getChildrenByType(r.Mesh).forEach(t=>{let r=n.viewMatrix,d=t.triangles.reduce((t,o)=>{let h=o.getCopy();h.applyMatrixMut(w);let v=h.vertexes[1].subtract(h.vertexes[0]),d=h.vertexes[2].subtract(h.vertexes[0]),c=x(l(v,d)),p=u(c,h.vertexes[0].subtract(n.position));if(p>=0||isNaN(p))return t;h.applyMatrixMut(r);//Clip triangle against near plane
let _=A(new a(0,0,n.zNear),new a(0,0,1),h).map(t=>(t.normal=c,t.applyMatrixMut(e).normalizeInScreenSpaceMut(i,s)),[]);return[...t,..._]},[]),c=d;h.forEach(({point:t,normal:e})=>{c=c.reduce((r,i)=>[...r,...A(t,e,i)],[])}),c.forEach(e=>{this._generateTriangleData(e,o.canvas.width,v,t.texture)})}),o.putImageData(v,0,0)})}static _setPixelData(t,e,r,i){i.data[r*(4*i.width)+4*e]=t[0],i.data[r*(4*i.width)+4*e+1]=t[1],i.data[r*(4*i.width)+4*e+2]=t[2],i.data[r*(4*i.width)+4*e+3]=t[3]}static _generateTriangleData(t,e,r,i){let s=(t,s,o,n,a,h,v,w,d,x)=>{//ending values
let u=x[0].u+(t-x[0].y)*v,l=x[0].v+(t-x[0].y)*w,c=x[0].w+(t-x[0].y)*d;s>o&&([s,o]=[o,s],[n,u]=[u,n],[a,l]=[l,a],[h,c]=[c,h]);let p=0,_=1/(o-s),[y,f,g]=[n,a,h];for(let v=s;v<o;v++){y=(1-p)*n+p*u,f=(1-p)*a+p*l,g=(1-p)*h+p*c;let w=Math.round(t),d=Math.round(v),x=w*e+d;//FIXME: убрать это из window
if(g>window.depthBuffer[x]){//FIXME: говно какое-то
let t;t=d===s||d+1>=o||d>=o?[0,255,0,255]:i?R(i,y/g,f/g):[255,0,255,255],this._setPixelData(t,d,w,r),window.depthBuffer[x]=g}p+=_}},o=[{x:t.vertexes[0].x,y:t.vertexes[0].y,u:t.UVCoordinates[0].u,v:t.UVCoordinates[0].v,w:t.UVCoordinates[0].w},{x:t.vertexes[1].x,y:t.vertexes[1].y,u:t.UVCoordinates[1].u,v:t.UVCoordinates[1].v,w:t.UVCoordinates[1].w},{x:t.vertexes[2].x,y:t.vertexes[2].y,u:t.UVCoordinates[2].u,v:t.UVCoordinates[2].v,w:t.UVCoordinates[2].w}].sort((t,e)=>t.y-e.y),n=Math.round(o[1].y-o[0].y),a=Math.round(o[1].x-o[0].x),h=o[1].v-o[0].v,v=o[1].u-o[0].u,w=o[1].w-o[0].w,d=Math.round(o[2].y-o[0].y),x=Math.round(o[2].x-o[0].x),u=o[2].v-o[0].v,l=o[2].u-o[0].u,c=o[2].w-o[0].w,p=0,_=0,y=0,f=0,g=0,M=0,m=0,C=0;if(n&&(p=a/Math.abs(n)),d&&(_=x/Math.abs(d)),n&&(y=v/Math.abs(n)),n&&(f=h/Math.abs(n)),n&&(m=w/Math.abs(n)),d&&(g=l/Math.abs(d)),d&&(M=u/Math.abs(d)),d&&(C=c/Math.abs(d)),n)for(let t=o[0].y;t<=o[1].y;t++){let e=Math.round(o[0].x+(t-o[0].y)*p),r=Math.round(o[0].x+(t-o[0].y)*_),i=o[0].u+(t-o[0].y)*y,n=o[0].v+(t-o[0].y)*f,a=o[0].w+(t-o[0].y)*m;s(t,e,r,i,n,a,g,M,C,o)}if(n=Math.round(o[2].y-o[1].y),a=Math.round(o[2].x-o[1].x),h=o[2].v-o[1].v,v=o[2].u-o[1].u,w=o[2].w-o[1].w,n&&(p=a/Math.abs(n)),d&&(_=x/Math.abs(d)),y=0,f=0,n&&(y=v/Math.abs(n)),n&&(f=h/Math.abs(n)),n&&(m=w/Math.abs(n)),n)for(let t=o[1].y;t<=o[2].y;t++){let e=Math.round(o[1].x+(t-o[1].y)*p),r=Math.round(o[0].x+(t-o[0].y)*_),i=o[1].u+(t-o[1].y)*y,n=o[1].v+(t-o[1].y)*f,a=o[1].w+(t-o[1].y)*m;s(t,e,r,i,n,a,g,M,C,o)}}}class F{constructor(){this._id=String(Math.random())//FIXME: add guid generation
,this._type=r.Entity}get id(){return this._id}get type(){return this._type}}class N extends F{constructor(t,e){super(),this._triangles=t,this._texture=e,this._type=r.Mesh}get triangles(){return this._triangles}set triangles(t){this._triangles=t}get texture(){return this._texture}set texture(t){this._texture=t}}var H={};H="# Blender 4.0.2\r\n# www.blender.org\r\no Cube\r\nv 1.000000 1.000000 -1.000000\r\nv 1.000000 -1.000000 -1.000000\r\nv 1.000000 1.000000 1.000000\r\nv 1.000000 -1.000000 1.000000\r\nv -1.000000 1.000000 -1.000000\r\nv -1.000000 -1.000000 -1.000000\r\nv -1.000000 1.000000 1.000000\r\nv -1.000000 -1.000000 1.000000\r\nvt 0.875000 0.500000\r\nvt 0.625000 0.750000\r\nvt 0.625000 0.500000\r\nvt 0.375000 1.000000\r\nvt 0.375000 0.750000\r\nvt 0.625000 0.000000\r\nvt 0.375000 0.250000\r\nvt 0.375000 0.000000\r\nvt 0.375000 0.500000\r\nvt 0.125000 0.750000\r\nvt 0.125000 0.500000\r\nvt 0.625000 0.250000\r\nvt 0.875000 0.750000\r\nvt 0.625000 1.000000\r\ns 0\r\nf 5/1 3/2 1/3\r\nf 3/2 8/4 4/5\r\nf 7/6 6/7 8/8\r\nf 2/9 8/10 6/11\r\nf 1/3 4/5 2/9\r\nf 5/12 2/9 6/7\r\nf 5/1 7/13 3/2\r\nf 3/2 7/14 8/4\r\nf 7/6 5/12 6/7\r\nf 2/9 4/5 8/10\r\nf 1/3 3/2 4/5\r\nf 5/12 1/3 2/9\r\n";var D={};D=new URL("cubetexture.0f1795bd.jpg",import.meta.url).toString();class S{constructor({rotation:t,position:e}){this._rotation=t,this._position=e,this._rotationXMatrix=this._newAxisRotationMatrix("x"),this._rotationYMatrix=this._newAxisRotationMatrix("y"),this._rotationZMatrix=this._newAxisRotationMatrix("z"),this._rotationMatrix=this._createRotationMatrix()}get rotationMatrix(){return this._rotationMatrix}get rotation(){return this._rotation}get position(){return this._position}set rotation(t){let e=this.rotation.x!==t.x,r=this.rotation.y!==t.y,i=this.rotation.z!==t.z;this._rotation=t,e&&this._updateAxisRotationMatrix("x"),r&&this._updateAxisRotationMatrix("y"),i&&this._updateAxisRotationMatrix("z"),(e||r||i)&&(this._rotationMatrix=this._createRotationMatrix())}set position(t){this._position=t}_createRotationMatrix(){return M(this._rotationXMatrix,M(this._rotationYMatrix,this._rotationZMatrix))}_updateAxisRotationMatrix(t){switch(t){case"x":this._rotationXMatrix=this._newAxisRotationMatrix(t);break;case"y":this._rotationYMatrix=this._newAxisRotationMatrix(t);break;case"z":this._rotationZMatrix=this._newAxisRotationMatrix(t)}}_newAxisRotationMatrix(t){switch(t){case"x":return c(this.rotation.x);case"y":return _(this.rotation.y);case"z":return p(this.rotation.z)}}}class L extends F{constructor({rotation:t,position:e}){super(),this._transform=new S({rotation:t,position:e}),this._parent=void 0,this._children=[],this._type=r.GameObject}get children(){return this._children}get transform(){return this._transform}get position(){return this._transform.position}get rotation(){return this._transform.rotation}set position(t){this._transform.position=t}set rotation(t){this._transform.rotation=t}getChildrenByType(t){return this._children.filter(e=>e.type===t)}setParent(t){this._parent=t}removeParent(){this._parent=void 0}addChild(t){this._children=[...this.children,t]}removeChild(t){this._children=this.children.filter(e=>e.id!==t)}}//FIXME: верх почему-то -Y, скорее всего дело в том, что на канвасе отсчёт от левого верхнего угла идёт.
//Не уверен, что это проблема вообще
const B=new a(0,-1,0),W={viewportWidth:640,viewportHeight:480,zFar:1e3,zNear:.1,fov:75},k={KeyA:"MoveLeft",ArrowLeft:"MoveLeft",KeyD:"MoveRight",ArrowRight:"MoveRight",KeyW:"MoveForward",ArrowUp:"MoveForward",KeyS:"MoveBack",ArrowDown:"MoveBack"};class I{constructor(t){this._config=t?.config??k,this._state={},this._init()}get config(){return this._config}set config(t){this._config=t}_init(){this._initializeState(),this._addListeners()}_initializeState(){Object.values(this.config).forEach(t=>{this._state[t]=!1})}_addListeners(){//FIXME: it might  be better to set up all events in one listener
Object.keys(this.config).forEach(t=>{window.addEventListener("keydown",e=>{e.code===t&&(this._state[this.config[t]]=!0)}),window.addEventListener("keyup",e=>{e.code===t&&(this._state[this.config[t]]=!1)})})}isActive(t){if(void 0===this._state[t])throw Error(`Event ${t} was not provided in the config`);return this._state[t]}}const O=document.getElementById("canvas"),j=O.getContext("2d"),T=new class extends L{constructor({rotation:t,position:e,options:i}){super({rotation:t,position:e}),this._forward=new a(0,0,1),this._viewportWidth=i?.viewportWidth??W.viewportWidth,this._viewportHeight=i?.viewportHeight??W.viewportHeight,this._zFar=i?.zFar??W.zFar,this._zNear=i?.zNear??W.zNear,this._fov=i?.fov??W.fov,this._type=r.Camera}get viewportWidth(){return this._viewportWidth}set viewportWidth(t){this._viewportWidth=t}get viewportHeight(){return this._viewportHeight}set viewportHeight(t){this._viewportHeight=t}get zFar(){return this._zFar}set zFar(t){this._zFar=t}get zNear(){return this._zNear}set zNear(t){this._zNear=t}set fov(t){this._fov=t}get fov(){return this._fov}get viewportAspectRatio(){return this._viewportHeight/this._viewportWidth}get fovRadians(){return 1/Math.tan(.5*this._fov/180*Math.PI)}setForwardDirection(t){this._forward=t}get localAxis(){let t=this.transform.rotationMatrix,e=g(this._forward,t),r=this.position.add(e),i=x(r.subtract(this.position)),s=x(B.subtract(z(i,u(B,i)))),o=l(s,i);return{forward:i,up:s,right:o,position:this.position}}get viewMatrix(){let{position:t,right:e,up:r,forward:i}=this.localAxis;return C(m(t,e,r,i))}}({position:new a(0,0,0),rotation:new a(0,0,0)});window.camera=T;const{viewportAspectRatio:P,fovRadians:q,zFar:K,zNear:X,viewportWidth:Y,viewportHeight:G}=T,J=[[P*q,0,0,0],[0,q,0,0],[0,0,K/(K-X),1],[0,0,-K*X/(K-X),0]];// case 'KeyR': {
//     const vUp = multiplyVectorByScalar(up, -0.1)
//     camera.position = camera.position.subtract(vUp)
//     break
// }
// case 'KeyF': {
//     const vUp = multiplyVectorByScalar(up, -0.1)
//     camera.position = camera.position.add(vUp)
//     break
// }
// case 'KeyQ': {
//     camera.rotation =
//             new Vector3D(
//                 camera.rotation.x,
//                 camera.rotation.y + 0.1,
//                 camera.rotation.z
//             )
//     break
// }
// case 'KeyE': {
//     camera.rotation =
//             new Vector3D(
//                 camera.rotation.x,
//                 camera.rotation.y - 0.1,
//                 camera.rotation.z
//             )
//     break
// }
let Z=0;const $=document.getElementById("fps"),Q=t=>{T.rotation=new a(T.rotation.x-t.movementY/800,T.rotation.y-t.movementX/800,T.rotation.z)};let tt=!1;window.addEventListener("keypress",t=>{"Space"===t.code&&(tt?(window.removeEventListener("mousemove",Q),tt=!1):(window.addEventListener("mousemove",Q),tt=!0))}),(class{static async _loadTextureData(){let e=await fetch(/*@__PURE__*/t(D)),r=await e.blob(),i=await createImageBitmap(r),s=document.createElement("canvas"),o=s.getContext("2d");return s.width=i.width,s.height=i.height,o.drawImage(i,0,0),o.getImageData(0,0,s.width,s.height)}//FIXME: сделать загрузку по урлу
static async loadFromUrl(){let e;let r=/*@__PURE__*/t(H).split("\n"),i=[],s=[{triangles:[]}],o=[],n=0;return r.forEach(t=>{if("o"===t[0]&&(s[++n]={triangles:[]}),"v"===t[0]){if("t"===t[1]){let e=t.split(" ");o.push(new h(Number(e[1]),Number(e[2])))}else{let e=t.split(" ");i.push(new a(Number(e[1]),Number(e[2]),Number(e[3])))}}}),r.forEach(t=>{if("f"===t[0]){if(0===o.length){let e=t.split(" ");s[n].triangles.push(new w({vertexes:[i[e[1]-1],i[e[2]-1],i[e[3]-1]],UVCoordinates:[new h(0,0),new h(0,0),new h(0,0)]}))}else{let e=t.split(" ").map(t=>t.split("/"));s[n].triangles.push(new w({vertexes:[i[e[1][0]-1],i[e[2][0]-1],i[e[3][0]-1]],UVCoordinates:[o[e[1][1]-1],o[e[2][1]-1],o[e[3][1]-1]]}))}}}),0!==o.length&&(e=await this._loadTextureData()),s.map(t=>new N(t.triangles,e))}}).loadFromUrl().then(t=>{let e=new L({rotation:new a(0,0,0),position:new a(0,0,6)});t.forEach(t=>e.addChild(t));let r=[e],i=new I,s=t=>{let e=t-Z;//FIXME: добавить как дебаг функцию
$.textContent=`FPS: ${(1e3/e).toFixed(0)}`;let{forward:o,right:n}=T.localAxis,h=new a(0,0,0);if(i.isActive("MoveRight")){let t=z(n,-2*(e/1e3));h=h.add(t)}if(i.isActive("MoveLeft")){let t=z(n,-2*(e/1e3));h=h.subtract(t)}if(i.isActive("MoveForward")){let t=z(o,2*(e/1e3));h=h.add(t)}if(i.isActive("MoveBack")){let t=z(o,2*(e/1e3));h=h.subtract(t)}(0!==h.x||0!==h.y||0!==h.z)&&(T.position=T.position.add(h)),E.rasterize(r,J,Y,G,j),Z=t,requestAnimationFrame(s)};requestAnimationFrame(s)});//# sourceMappingURL=index.6becb380.js.map

//# sourceMappingURL=index.6becb380.js.map
